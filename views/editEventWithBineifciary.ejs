<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit Event</title>
    <style>
        .beneficiary {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .beneficiary input {
            display: block;
            margin-bottom: 5px;
            width: 100%;
        }
        .beneficiary button {
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <h1>Edit Event</h1>
    <form id="eventForm" action="/events/<%= event._id %>/edit" method="POST" enctype="multipart/form-data">

        <!-- Event Details -->
        <fieldset>
            <legend>Event Details</legend>
            <label for="eventName">Event Name:</label>
            <input type="text" id="eventName" name="eventName" value="<%= event.eventName %>" required><br><br>

            <label for="eventType">Event Type:</label>
            <select id="eventType" name="eventType" required>
                <option value="Workshop" <%= event.eventType === 'Workshop' ? 'selected' : '' %>>Workshop</option>
                <option value="Meeting" <%= event.eventType === 'Meeting' ? 'selected' : '' %>>Meeting</option>
                <option value="Training" <%= event.eventType === 'Training' ? 'selected' : '' %>>Training</option>
                <option value="Dialogues" <%= event.eventType === 'Dialogues' ? 'selected' : '' %>>Dialogues</option>
                <option value="Facilities" <%= event.eventType === 'Facilities' ? 'selected' : '' %>>Facilities</option>
                <option value="Inputs" <%= event.eventType === 'Inputs' ? 'selected' : '' %>>Inputs</option>
                <option value="Infrastructures" <%= event.eventType === 'Infrastructures' ? 'selected' : '' %>>Infrastructures</option>
            </select><br><br>

            <label for="startDate">Start Date:</label>
            <input type="date" id="startDate" name="startDate" value="<%= event.startDate.toISOString().split('T')[0] %>" required><br><br>

            <label for="endDate">End Date:</label>
            <input type="date" id="endDate" name="endDate" value="<%= event.endDate.toISOString().split('T')[0] %>" required><br><br>

            <label for="province">Province:</label>
            <input type="text" id="province" name="province" value="<%= event.venue.province %>" required><br><br>

            <label for="district">District:</label>
            <input type="text" id="district" name="district" value="<%= event.venue.district %>" required><br><br>

            <label for="municipality">Municipality:</label>
            <input type="text" id="municipality" name="municipality" value="<%= event.venue.municipality %>" required><br><br>

            <label for="nationalLevel">National Level:</label>
            <select id="nationalLevel" name="nationalLevel" required>
                <option value="National" <%= event.nationalLevel === 'National' ? 'selected' : '' %>>National</option>
                <option value="Provience" <%= event.nationalLevel === 'Provience' ? 'selected' : '' %>>Provience</option>
                <option value="District" <%= event.nationalLevel === 'District' ? 'selected' : '' %>>District</option>
                <option value="Municipality" <%= event.nationalLevel === 'Municipality' ? 'selected' : '' %>>Municipality</option>
            </select><br><br>

        </fieldset>

        <!-- Facilitators -->
        <fieldset>
            <legend>Facilitators</legend>
            <label for="facilitators">Facilitators (comma-separated):</label>
            <input type="text" id="facilitators" name="facilitators" value="<%= event.facilitators.join(', ') %>"><br><br>
        </fieldset>

        <!-- Beneficiaries -->
        <fieldset>
            <legend>Beneficiaries</legend>
            <div id="beneficiariesContainer">
                <% event.beneficiaries.forEach(function(beneficiary, index) { %>
                    <div class="beneficiary">
                        <label for="beneficiaryName<%= index %>">Beneficiary Name:</label>
                        <input type="text" id="beneficiaryName<%= index %>" name="beneficiaries[<%= index %>][name]" value="<%= beneficiary.name %>" required><br><br>

                        <label for="associatedOrg<%= index %>">Associated Organization:</label>
                        <input type="text" id="associatedOrg<%= index %>" name="beneficiaries[<%= index %>][associatedOrganization][name]" value="<%= beneficiary.associatedOrganization.name %>" required><br><br>

                        <label for="orgMain<%= index %>">Organization Main Type:</label>
                        <input type="text" id="orgMain<%= index %>" name="beneficiaries[<%= index %>][associatedOrganization][main]" value="<%= beneficiary.associatedOrganization.main %>" required><br><br>

                        <label for="benefitsFromActivity<%= index %>">Benefits from Activity:</label>
                        <input type="checkbox" id="benefitsFromActivity<%= index %>" name="beneficiaries[<%= index %>][benefitsFromActivity]" <%= beneficiary.benefitsFromActivity ? 'checked' : '' %>><br><br>

                        <label for="disability<%= index %>">Disability:</label>
                        <input type="checkbox" id="disability<%= index %>" name="beneficiaries[<%= index %>][disability]" <%= beneficiary.disability ? 'checked' : '' %>><br><br>

                        <button type="button" onclick="removeBeneficiary(<%= index %>)">Remove Beneficiary</button><br><br>
                    </div>
                <% }); %>
            </div>
            <button type="button" onclick="addBeneficiary()">Add Beneficiary</button><br><br>
        </fieldset>

        <!-- File Uploads -->
        <fieldset>
            <legend>File Uploads</legend>
            <label for="photographs">Upload Photographs:</label>
            <input type="file" id="photographs" name="photographs" multiple><br><br>

            <label for="reports">Upload Reports:</label>
            <input type="file" id="reports" name="reports" multiple><br><br>
        </fieldset>

        <!-- Submit -->
        <button type="submit">Update Event</button>
    </form>

<script>
    // Function to handle adding new beneficiaries
    function addBeneficiary() {
        const container = document.getElementById('beneficiariesContainer');
        const index = container.children.length;
        const beneficiaryHTML = `
            <div class="beneficiary">
                <label for="beneficiaryName${index}">Beneficiary Name:</label>
                <input type="text" id="beneficiaryName${index}" name="beneficiaries[${index}][name]" required><br><br>

                <label for="associatedOrg${index}">Associated Organization:</label>
                <input type="text" id="associatedOrg${index}" name="beneficiaries[${index}][associatedOrganization][name]" required><br><br>

                <label for="orgMain${index}">Organization Main Type:</label>
                <input type="text" id="orgMain${index}" name="beneficiaries[${index}][associatedOrganization][main]" required><br><br>

                <label for="benefitsFromActivity${index}">Benefits from Activity:</label>
                <input type="checkbox" id="benefitsFromActivity${index}" name="beneficiaries[${index}][benefitsFromActivity]"><br><br>

                <label for="disability${index}">Disability:</label>
                <input type="checkbox" id="disability${index}" name="beneficiaries[${index}][disability]"><br><br>

                <button type="button" onclick="removeBeneficiary(${index})">Remove Beneficiary</button><br><br>
            </div>
        `;
        container.insertAdjacentHTML('beforeend', beneficiaryHTML);
    }

    // Function to handle removing beneficiaries
    function removeBeneficiary(index) {
        const container = document.getElementById('beneficiariesContainer');
        container.removeChild(container.children[index]);
    }
</script>

</body>
</html>
